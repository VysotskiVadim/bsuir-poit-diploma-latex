\section{Модели и спецификация требований к программному средству}
\label{sec:funcreq}

\subsection{Теоритический анализ}

На основе теории рассмотренной в главе \ref{sec:domain} можно сделать выводы что задачу распознавания можно декомпозировать на следующие подзадачи применяемые последовательно:
\begin{itemize}
	\item пред-обработка;
	\item поиск номерного знака;
	\item распознание символов;
\end{itemize} 

Пре-обработка будет упоминаться в контексте остальных задач из за ее тесной связанности с ними.

\subsubsection{}
\label{seq:funcreq:analisys}
Поиск номерного знака

В разделе \ref{sub:domain:search:violajones} был рассмотрен метод Виолы - Джонса, именно его я буду использовать для нахождения номерного знака. Этот алгоритм достаточно трудно реализовать, не говоря уже об эффективной реализации, поэтому целесообразно использовать его реализацию из OpenCv. Но перед его использованием его нужно научить находить номерные знаки. Для этого требуется большая база данных изображений с положительными и отрицательными примерами, а также файл-дескриптор описывающий координаты искомого объекта, по которым будет сформирован каскад Хаара, представляющий из себя xml файл c описанем примитивов Хаара и их вычисляемых значений. При разработке очень поможет тот факт что метод Виолы - Джонса распознает объекты находящиеся под углом до $30\degree$

\subsubsection{}
Распознавание символов

В разделе \ref{sub:domain:recognition:tesseract} был рассмотрен инструмент для распознавания текста Tesseract. Хоть он и избавляет нас от большого количества работы реализуя распознавание он не идеален, и Google дает целый список рекомендаций как повысить качество распознавания \cite{tesseract_impruvment}, не выполняя эти рекомендации процент распознанных символов крайне мал.

После работы метода Виолы - Джонса на вход модулю распознающему текст приходит вырезанная рамка автомобильного номера. И тут сталкиваемся со следующими проблемами:
\begin{itemize}
	\item текст будет под углом;
	\item неравномерные отступы;
	\item на номере присутствуют не только символы;
\end{itemize}

Для хорошего распознавания текста на номерном знаке можно использовать следующий алгоритм:
\begin{enumerate}
	\item выделить контуры присутствующих символов;
	\item проанализировав размер выбрать символы;
	\item определить угол наклона номера по символам;
	\item вырезать символ по контуру взяв отступ в 3\% от размера;
	\item распознать по одному символу;
\end{enumerate} 
Рассмотрим каждый шаг подробнее.

Обучая метод Виолы - Джонса распознавать номера мы знаем примерно какую область будет выделять метод, поэтому нам известно какой процент от размера изображения должен занимать символ по высоте и по ширине, если быть точным выбирается диапазон размеров в которых лежат символы на изображении.

Определить угол наклона имея изображение не составляет труда зная положение символов. На изображении \ref{fig:funcreq:analisys} изображен условный пример для поиска угла наклона. Требуется провести прямую линию параллельную символам а затем имея координаты двух любых точек по определению вычислить тангенс и найти угол

$$ \alpha = \arctan(\frac{y_1 - y_2}{x_1 - x_2}) $$

\begin{figure}[ht]
\centering
    \includegraphics[scale=0.5]{find_angle.png}  
    \caption{Нахождение угла поворота таблички}
    \label{fig:funcreq:analisys}
\end{figure}

\subsection{Функциональная модель программного средства}
\label{sec:funcreq:funcmodel}

С оглядкой на существующие реализации рассматриваемой задачи определим варианты использования програмного средства.

\begin{figure}[ht]
\centering
    \includegraphics[scale=1]{func_model.jpg}  
    \caption{Диаграмма вариантов использования}
  \label{fig:funcreq:funcmodel}
\end{figure}

На основе вариантов использования для разрабатываемого программного средства формируется следующий набор функциональных требований:
\begin{itemize}
	\item Подключение и обработка видеопотока с IP камеры
	\item Загрузка изображения для распознавания.
	\item Загрузка изображения для запуска отдельных, выбранных пользователе фильтров.
	\item Подключение плагинов для интеграции с существующей инфраструктурой.
\end{itemize}

\subsection{Спецификация требований к программному средству}
\label{sec:fucreq:specification}

\subsubsection{}
Подключение IP камер. Требования:
\begin{itemize}
	\item Возможность добавить камеру должна быть как с командной строки так и из пользовательского интерфейса
	\item Адреса добавленных IP камер должны сохранятся и при перезапуске сервера, сервер должен снова подключится к камерам
	\item Должна быть возможность добавить несколько IP камер.
	\item У каждой IP камеры кроме имени должен быть псевдоним, который будет передаваться вместе с результатами распознавания в плагины. 
\end{itemize}

\subsubsection{}
Загрузка изображений для распознавания. Требования:
\begin{itemize}
	\item Возможность загрузить изображение на сервер для распознавания
	\item Поддержка форматов PNG и JPEG
\end{itemize}

\subsubsection{}
Загрузка изображений для запуска отельных фильтров. Требования:
\begin{itemize}
	\item Возможность загрузить изображение на сервер для запуска отдельных фильтров
	\item Поддержка форматов PNG и JPEG
\end{itemize}

\subsubsection{}
Подключение плагинов для обработки результатов распознавания. Требования:
\begin{itemize}
	\item Плагины подключаются путем копирования dll файлов в директорию plugins
	\item для создания плагинов требуется используя библиотеку реализовать интерфейс обработчика результатов на платформе \dotnet{}
\end{itemize}

\subsubsection{}
Процесс распознавания номеров. Требования:
\begin{itemize}
	\item Сервер должен обрабатывать видеопоток от IP камер
	\item При распознании номера результаты должны быть переданны подключенным плагинам
\end{itemize}

\subsubsection{}
Пользовательский интерфейс програмного средства.
\begin{itemize}
	\item Пользовательский интерфейс должен быть Web страницей
	\item Должны поддерживаться Google Chrome и Firefox последних версий.
	\item Должны быть возможность конфигурирования сервера через командную строку.
\end{itemize}

\subsubsection{}
Совместимость программного средства
\begin{itemize}
	\item Требуется совместимость с Windows 10
\end{itemize}