\section{Модели и спецификация требований к программному средству}
\label{sec:funcreq}

\subsection{Теоритический анализ}
\label{sec:funcreq:teoretical_anolisys}

На основе теории рассмотренной в главе \ref{sec:domain} можно сделать выводы что задачу распознавания можно декомпозировать на следующие подзадачи применяемые последовательно:
\begin{itemize}
	\item пред-обработка;
	\item поиск номерного знака;
	\item распознание символов.
\end{itemize} 

Пред-обработка будет упоминаться в контексте остальных задач из за ее тесной связанности с ними.

\subsubsection{Поиск номерного знака}
\label{seq:funcreq:analisys}

В разделе \ref{sub:domain:search:violajones} был рассмотрен метод Виолы - Джонса, именно его я буду использовать для нахождения номерного знака. 
\begin{figure}[ht]
\centering
  \begin{subfigure}[b]{0.48\textwidth} 
    \centering
    \includegraphics[width=\textwidth]{before_viola.png}  
    \caption{Исходное изображение}
  \end{subfigure}
  \begin{subfigure}[b]{0.48\textwidth} 
    \centering
    \includegraphics[width=\textwidth]{after_viola.png}  
    \caption{Обработанное изображение}
  \end{subfigure}
  \caption{Результат работы метода Виолы - Джонса}
  \label{fig:funcreq:analisys:viola}
\end{figure}
Этот алгоритм достаточно трудно реализовать, не говоря уже об эффективной реализации, поэтому целесообразно использовать его реализацию из OpenCv. Но перед его использованием его нужно научить находить номерные знаки. Для этого требуется большая база данных изображений с положительными и отрицательными примерами, а также файл-дескриптор описывающий координаты искомого объекта, по которым будет сформирован каскад Хаара, представляющий из себя xml файл c описанем примитивов Хаара и их вычисляемых значений. При разработке очень поможет тот факт что метод Виолы - Джонса распознает объекты находящиеся под углом до $30\degree$. На изображении \ref{fig:funcreq:analisys:viola} можно увидеть пример работы метода Виолы - Джонса, найденная номерная табличка была выделенна белой рамкой для наглядности. Как можно заметить хоть метод и находит изображения повернутые на угол до $30\degree$ но не определяет поворот таблички. 

\subsubsection{Распознавание символов}

В разделе \ref{sub:creation:tesseract} рассмотрен инструмент для распознавания текста Tesseract. Хоть он и избавляет нас от большого количества работы реализуя распознавание он не идеален, и Google дает целый список рекомендаций как повысить качество распознавания \cite{tesseract_impruvment}, не выполняя эти рекомендации процент распознанных символов крайне мал.

После работы метода Виолы - Джонса на вход модулю распознающему текст приходит вырезанная рамка автомобильного номера. И тут сталкиваемся со следующими проблемами:
\begin{itemize}
	\item текст будет под углом;
	\item неравномерные отступы;
	\item на номере присутствуют не только символы.
\end{itemize}

Прежде всего текст нужно выровнять. Эту проблему можно решать по разному. Считаю наиболее рациональным подходом найти отдельные символы затем по их координатам определить угол. На изображении \ref{fig:funcreq:analisys} изображен условный пример для поиска угла наклона. Требуется провести прямую линию параллельную символам а затем имея координаты двух любых точек по определению вычислить тангенс и найти угол $\alpha = \arctan(\frac{y_1 - y_2}{x_1 - x_2})$

\begin{figure}[ht]
\centering
    \includegraphics[scale=0.5]{find_angle.png}  
    \caption{Нахождение угла поворота таблички}
    \label{fig:funcreq:analisys}
\end{figure}

Для решения с отступами и посторонними артефактами можно попросту распознавать по одному символу, находить же символы можно по анализу контуров похожему на рассмотренный в разделе \ref{sub:domain:search:edges_analisys}. Пример работы алгоритма поиска контуров можно увидеть на изображении \ref{fig:funcreq:analisys:contour}.

\begin{figure}[ht]
\centering
  \begin{subfigure}[b]{0.48\textwidth} 
    \centering
    \includegraphics[width=\textwidth]{before_contour_analisys.png}  
    \caption{Исходное изображение}
  \end{subfigure}
  \begin{subfigure}[b]{0.48\textwidth} 
    \centering
    \includegraphics[width=\textwidth]{after_contour_analisys.png}  
    \caption{Обработанное изображение}
  \end{subfigure}
  \caption{Результат поиска контуров}
  \label{fig:funcreq:analisys:contour}
\end{figure}

Найти символы среди всех контуров можно проанализировав размеры каждого контура. Повернув и вырезав отдельные символы их можно передавать к Tessract. 

\subsection{Функциональная модель программного средства}
\label{sec:funcreq:funcmodel}

С оглядкой на существующие реализации рассматриваемой задачи определим варианты использования програмного средства представленных на рисунке \ref{fig:funcreq:funcmodel}.

\begin{figure}[p]
\centering
    \includegraphics[scale=1]{use_case.png}  
    \caption{Диаграмма вариантов использования}
  \label{fig:funcreq:funcmodel}
\end{figure}

На основе вариантов использования для разрабатываемого программного средства формируется следующий набор функциональных требований:
\begin{itemize}
	\item подключение и обработка видеопотока с IP камеры;
  \item отключение от IP камеры;
	\item послать сигнал открытия вручную;
	\item загрузка изображения для распознавания;
	\item подключение плагинов обрабатывающих результаты распознавания;
	\item отключение плагинов обрабатывающих результат распознавания.
\end{itemize}

\subsection{Спецификация требований к программному средству}
\label{sec:fucreq:specification}

\subsubsection{Подключение IP камер}
\begin{itemize}
	\item возможность подключится либо отключиться от камеры должна быть из пользовательского веб интерфейса;
	\item адреса добавленных IP камер должны сохранятся и при перезапуске сервера, сервер должен снова подключится к камерам;
	\item должна быть возможность добавить несколько IP камер;
	\item у каждой IP камеры кроме имени должен быть псевдоним, указываемый при подключении, который будет передаваться вместе с результатами распознавания в плагины.
\end{itemize}

\subsubsection{Загрузка изображений для распознавания}
\begin{itemize}
	\item возможность загрузить изображение на сервер для распознавания;
	\item поддержка форматов PNG и JPEG;
  \item должны быть показанны все шаги по распознаванию.
\end{itemize}

\subsubsection{Подключение плагинов}
\begin{itemize}
	\item плагины подключаются путем копирования dll файлов в директорию plugins, рядом с исполняемым файлом;
	\item для создания плагинов требуется используя библиотеку реализовать интерфейс обработчика результатов на платформе \dotnet{};
	\item плагины обрабатывают положительный и отрицательный результат.
\end{itemize}

\subsubsection{Процесс распознавания номеров}
\begin{itemize}
	\item сервер должен обрабатывать видеопоток от IP камер;
	\item при распознании результаты передаются подключенным плагинам;
	\item при команде открытия шлагбаума от оператора требуется передать плагинам отрицательный результат для обработки.
\end{itemize}

\subsubsection{Пользовательский интерфейс програмного средства}
\begin{itemize}
	\item пользовательский интерфейс должен быть Web страницей;
	\item должны поддерживаться Google Chrome и Firefox последних версий.
\end{itemize}

\subsubsection{Совместимость программного средства}
\begin{itemize}
  \item операционная система Windows не ниже 7 версии;
	\item CPU не менее 2.6 GGz 2 на обрабатываемый видеопоток;
  \item RAM 2 Gb + по 500 Mb на каждую обрабатываемую камеру.
\end{itemize}